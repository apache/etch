// This file automatically generated by:
// $version
// $now
#set($i = $intf.name())

using System;
using System.Collections.Generic;
using System.Text;

using Etch.Msg;
using Etch.Support;
using Etch.Transport;
using System.Collections;
using Etch.Util;

/// <summary>
/// Transport helper for ${intf.name()}.
/// </summary>
namespace $intf.parent().name()
{
    public class ${i}Helper : TransportHelper
    {

        public ${i}Helper()
        {
            // Don't allow construction, all methods are static.
        }

#if ( $helper.isServer($mc) || $helper.isBoth($mc) ) 
		/// <summary>Constructs a new server session listener per specifications
		/// in uri and resources.</summary>
		/// <param name="uri"> contains specifications for the server session
		/// listener and for the server session transport stack.</param>
		/// <param name="resources"> additional resources to aid in constructing
		/// new server sessions.</param>
		/// <param name="implFactory"> called upon accepting a new server session to
		/// construct a new server implementation to handle messages
		/// from the client during the session.</param>
		/// <returns> an out-of-band source that may be used to control
		/// the listener.</returns>

		public static Transport<SessionListener> NewListener( string uri,		
			Resources resources, ${intf.name()}ServerFactory implFactory )
		{
			Resources res = InitResources( resources );
			if (!res.ContainsKey( Messagizer.VALUE_FACTORY ))
			res.Add( Messagizer.VALUE_FACTORY, new ValueFactory${i}() );					
			return TransportFactory.GetListener( uri, res, new MyServerFactory( uri, res, implFactory ) );
		}
		
		public class MyServerFactory : ServerFactory
		{
		
			private string _uri;
			private Resources _resources;
			private ${intf.name()}ServerFactory _implFactory;
			
			public MyServerFactory( string uri, Resources resources, ${intf.name()}ServerFactory implFactory ) 
			{
				_uri = uri;
				_resources = resources;
				_implFactory = implFactory;
			}
		
			public void NewServer( DeliveryService d )
			{
				Remote${i}Client client = new Remote${i}Client( d );
				${i}Server server = _implFactory.New${i}Server( client );
				Pool qp = (Pool) _resources[ QUEUED_POOL ];
				Pool fp = (Pool) _resources[ FREE_POOL ];
				new Stub${i}Server( d, server, qp, fp );
			}
			
		}
		
		/// <summary>
		/// Factory for a Listener to use to create new instances of ${intf.name()}Server.
		/// </summary>
		
		public interface ${i}ServerFactory
		{
			/// <param name="client"> an Remote${i}Client instance for server implementation
			/// to use to call back to the client.</param>
			/// <returns> an instance of ${intf.name()}Server (e.g., Impl${intf.name()}Server) to
			/// handle messages which arrive from the client.</returns>
			
			${i}Server New${i}Server( Remote${i}Client client );
		}		
#end
	
#if ( $helper.isClient($mc) || $helper.isBoth($mc) ) 
		/// <summary>Constructs a new client session per specifications in uri
		/// and resources.</summary>
		/// <param name="uri"> contains specifications for the client session
		/// transport stack.</param>
		/// <param name="resources"> additional resources to aid in constructing
		/// new sessions.</param>
		/// <param name="implFactory">factory used to construct a new instance implementing
		/// ${i}Client. The new instance will receive and process messages from the
		///	server session.</param>
		/// <returns> new remote server instance initialized by uri
		/// and resources which may be used to send messages to the
		/// server session.</returns>
		
		public static Remote${i}Server NewServer( string uri,
			Resources resources, ${i}ClientFactory implFactory )
		{
			resources = InitResources( resources );
			if (!resources.ContainsKey( Messagizer.VALUE_FACTORY ))
				resources.Add( Messagizer.VALUE_FACTORY, new ValueFactory${intf.name()}() );
			DeliveryService d = TransportFactory.GetTransport( uri, resources );
			Remote${i}Server server = new Remote${i}Server( d );
			${i}Client client = implFactory.New${i}Client( server );			
			 new Stub${i}Client( d,
					client,
					(Pool) resources[ QUEUED_POOL ],
					(Pool) resources[ FREE_POOL ] );
	
			return server;
		}
		
		///<summary>
		///Factory used by
		///{@link ${i}Helper#new${i}Server(String, Resources, ${i}ClientFactory)}
		///to construct a new instance implementing {@link ${i}Client}. The new
		///instance will receive and process messages from the server session.
		///</summary>
		
		public interface ${i}ClientFactory
		{
			///<summary>
			///Constructs a new instance implementing ${i}Client. The new
			///instance will receive and process messages from the server session.</summary>
		 	///<param name=server> an instance of Remote${i}Server which may be used to
			/// send messages to the server session. </param>
			///<returns> new instance implementing ${i}Client (typically
			///Impl${i}Client). </returns>
			
			${i}Client New${i}Client( Remote${i}Server server );			
		}
#end
	}
}
