// Generated by:
// @EtchVersion@ (@EtchBuildTag@) / java @EtchVersion@ (@EtchBuildTag@)
// Thu May 01 09:15:13 CDT 2008

package etch.examples.benchmark.etch;

import java.util.Date;

import etch.util.Log;
import etch.util.core.io.Session;


/**
 * Your custom implementation of BasePerfServer. Add methods here to provide
 * implementations of messages from the client.
 */
public class ImplPerfServer extends BasePerfServer
{
	/**
	 * Constructs the ImplPerfServer.
	 *
	 * @param client a connection to the client session. Use this to send a
	 * message to the client.
	 */
	public ImplPerfServer( RemotePerfClient client )
	{
		this.client = client;
		name = "ImplPerfServer@"+Integer.toString( hashCode(), 36 );
		Log.report( "ImplPerfServerUp", "instance", this );
		t0 = System.nanoTime();
	}
	
	private final RemotePerfClient client;
	
	private final String name;
	
	private final long t0;
	
	@Override
	public String toString()
	{
		return name;
	}
	
	public Integer add( Integer x, Integer y )
	{
		adds++;
		return x + y;
	}
	
	private int adds;

	public Integer sum( int[] values )
	{
		sums++;
		int sum = 0;
		for (int value: values)
			sum += value;
		return sum;
	}
	
	private int sums;

	public void report( Integer code, String msg )
	{
		reports++;
	}
	
	private int reports;
	
	public Point dist( Point a, Point b )
	{
		dists++;
		return new Point( b.x - a.x, b.y - a.y );
	}
	
	private int dists;
	
	public Date add2( Date ts, Long ms )
	{
		add2s++;
		return new Date( ts.getTime()+ms );
	}
	
	private int add2s;
	
	public void report2( Date ts, Integer code, String msg )
	{
		report2s++;
	}
	
	private int report2s;

	public void _sessionNotify( Object event ) throws Exception
	{
		if (event == Session.DOWN)
		{
			double time = (System.nanoTime() - t0) / 1000000000.0;
			int total = adds + sums + reports + dists + add2s + report2s;
			double rate = total / time;
			Log.report( "ImplPerfServerDown",
				"instance", this,
				"adds", adds,
				"sums", sums,
				"reports", reports,
				"dists", dists,
				"add2s", add2s,
				"report2s", report2s,
				"total", total,
				"time", time,
				"rate", rate );
		}
	}
}